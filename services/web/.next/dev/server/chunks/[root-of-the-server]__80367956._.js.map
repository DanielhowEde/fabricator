{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///app/app/api/images/generate/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport const runtime = \"nodejs\"; // important: don't run this on edge\n\ntype Body = {\n  prompt: string;\n  size?: \"512x512\" | \"1024x1024\" | \"1536x1536\";\n  output_format?: \"png\" | \"jpeg\" | \"webp\";\n};\n\nexport async function POST(req: Request) {\n  try {\n    const body = (await req.json()) as Body;\n\n    if (!body?.prompt || body.prompt.trim().length < 3) {\n      return NextResponse.json({ error: \"Prompt is required.\" }, { status: 400 });\n    }\n\n    const r = await fetch(\"https://api.openai.com/v1/images/generations\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${process.env.OPENAI_API_KEY}`,\n      },\n      body: JSON.stringify({\n        model: \"gpt-image-1\",\n        prompt: body.prompt,\n        size: body.size ?? \"1024x1024\",\n        output_format: body.output_format ?? \"png\",\n      }),\n    });\n\n    if (!r.ok) {\n      const errText = await r.text();\n      return NextResponse.json(\n        { error: \"OpenAI image generation failed\", details: errText },\n        { status: 500 }\n      );\n    }\n\n    const data = await r.json();\n\n    // For GPT image models, responses are base64 images (b64_json). :contentReference[oaicite:1]{index=1}\n    const b64 = data?.data?.[0]?.b64_json;\n    if (!b64) {\n      return NextResponse.json(\n        { error: \"No image returned from OpenAI.\" },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      ok: true,\n      b64,\n      mime: body.output_format === \"jpeg\" ? \"image/jpeg\" : body.output_format === \"webp\" ? \"image/webp\" : \"image/png\",\n    });\n  } catch (e: any) {\n    return NextResponse.json(\n      { error: \"Unexpected error\", details: String(e?.message ?? e) },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,UAAU,UAAU,oCAAoC;AAQ9D,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAQ,MAAM,IAAI,IAAI;QAE5B,IAAI,CAAC,MAAM,UAAU,KAAK,MAAM,CAAC,IAAI,GAAG,MAAM,GAAG,GAAG;YAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,IAAI,MAAM,MAAM,gDAAgD;YACpE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,eAAe,CAAC,OAAO,EAAE,QAAQ,GAAG,CAAC,cAAc,EAAE;YACvD;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,QAAQ,KAAK,MAAM;gBACnB,MAAM,KAAK,IAAI,IAAI;gBACnB,eAAe,KAAK,aAAa,IAAI;YACvC;QACF;QAEA,IAAI,CAAC,EAAE,EAAE,EAAE;YACT,MAAM,UAAU,MAAM,EAAE,IAAI;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAkC,SAAS;YAAQ,GAC5D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,EAAE,IAAI;QAEzB,sGAAsG;QACtG,MAAM,MAAM,MAAM,MAAM,CAAC,EAAE,EAAE;QAC7B,IAAI,CAAC,KAAK;YACR,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiC,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ;YACA,MAAM,KAAK,aAAa,KAAK,SAAS,eAAe,KAAK,aAAa,KAAK,SAAS,eAAe;QACtG;IACF,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAoB,SAAS,OAAO,GAAG,WAAW;QAAG,GAC9D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}