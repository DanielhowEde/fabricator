{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///app/app/api/images/generate/route.ts"],"sourcesContent":["import OpenAI from \"openai\";\n\nexport const runtime = \"nodejs\";\n\nconst client = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n});\n\nfunction generateMockImage(text: string) {\n  // 1024x1024 simple SVG â†’ PNG base64\n  const svg = `\n    <svg width=\"1024\" height=\"1024\" xmlns=\"http://www.w3.org/2000/svg\">\n      <rect width=\"100%\" height=\"100%\" fill=\"#e5e7eb\"/>\n      <text x=\"50%\" y=\"45%\" dominant-baseline=\"middle\" text-anchor=\"middle\"\n            font-size=\"48\" font-family=\"Arial\" fill=\"#111827\">\n        MOCK IMAGE\n      </text>\n      <text x=\"50%\" y=\"55%\" dominant-baseline=\"middle\" text-anchor=\"middle\"\n            font-size=\"28\" font-family=\"Arial\" fill=\"#374151\">\n        ${text.replace(/</g, \"\").slice(0, 80)}\n      </text>\n    </svg>\n  `;\n\n  const b64 = Buffer.from(svg).toString(\"base64\");\n  return {\n    ok: true,\n    b64,\n    mime: \"image/svg+xml\",\n  };\n}\n\nexport async function POST(req: Request) {\n  const mock = process.env.MOCK_IMAGE_GEN === \"true\";\n\n  try {\n    const { prompt, size, gender, photoType, pose } = await req.json();\n\n    if (!prompt) {\n      return Response.json(\n        { ok: false, error: \"Missing prompt\" },\n        { status: 400 }\n      );\n    }\n\n    // ðŸ”¹ MOCK MODE (no OpenAI call)\n    if (mock) {\n      const label = `${gender ?? \"\"} ${pose ?? \"\"} ${photoType ?? \"\"}`.trim();\n      return Response.json(generateMockImage(label));\n    }\n\n    // ðŸ”¹ REAL OPENAI MODE\n    const img = await client.images.generate({\n      model: \"gpt-image-1.5\",\n      prompt,\n      size: size ?? \"1024x1024\",\n    });\n\n    const b64 = img.data?.[0]?.b64_json;\n    if (!b64) {\n      return Response.json(\n        { ok: false, error: \"No image returned\" },\n        { status: 502 }\n      );\n    }\n\n    return Response.json({\n      ok: true,\n      b64,\n      mime: \"image/png\",\n    });\n  } catch (e: any) {\n    console.error(\"Image generation error:\", e);\n    return Response.json(\n      { ok: false, error: e?.message ?? \"Unknown error\" },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEO,MAAM,UAAU;AAEvB,MAAM,SAAS,IAAI,mLAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAEA,SAAS,kBAAkB,IAAY;IACrC,oCAAoC;IACpC,MAAM,MAAM,CAAC;;;;;;;;;QASP,EAAE,KAAK,OAAO,CAAC,MAAM,IAAI,KAAK,CAAC,GAAG,IAAI;;;EAG5C,CAAC;IAED,MAAM,MAAM,OAAO,IAAI,CAAC,KAAK,QAAQ,CAAC;IACtC,OAAO;QACL,IAAI;QACJ;QACA,MAAM;IACR;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,QAAQ,GAAG,CAAC,cAAc,KAAK;IAE5C,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAEhE,IAAI,CAAC,QAAQ;YACX,OAAO,SAAS,IAAI,CAClB;gBAAE,IAAI;gBAAO,OAAO;YAAiB,GACrC;gBAAE,QAAQ;YAAI;QAElB;QAEA,gCAAgC;QAChC,IAAI,MAAM;YACR,MAAM,QAAQ,GAAG,UAAU,GAAG,CAAC,EAAE,QAAQ,GAAG,CAAC,EAAE,aAAa,IAAI,CAAC,IAAI;YACrE,OAAO,SAAS,IAAI,CAAC,kBAAkB;QACzC;QAEA,sBAAsB;QACtB,MAAM,MAAM,MAAM,OAAO,MAAM,CAAC,QAAQ,CAAC;YACvC,OAAO;YACP;YACA,MAAM,QAAQ;QAChB;QAEA,MAAM,MAAM,IAAI,IAAI,EAAE,CAAC,EAAE,EAAE;QAC3B,IAAI,CAAC,KAAK;YACR,OAAO,SAAS,IAAI,CAClB;gBAAE,IAAI;gBAAO,OAAO;YAAoB,GACxC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,SAAS,IAAI,CAAC;YACnB,IAAI;YACJ;YACA,MAAM;QACR;IACF,EAAE,OAAO,GAAQ;QACf,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,SAAS,IAAI,CAClB;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAgB,GAClD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}