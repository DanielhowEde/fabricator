services:
  web:
    build: ./services/web
    ports:
      - "5173:5173"
    environment:
      - NEXT_PUBLIC_API_BASE=http://localhost:8000
      - PYTHON_BASE_URL=http://python:8000
    volumes:
      - ./services/web:/app
      - ./services/web/.env.local:/app/.env.local:ro
      - web_node_modules:/app/node_modules
    depends_on:
      - node
      - python
    command: sh -lc "npm install && npm run dev -- -H 0.0.0.0 -p 5173"

  node:
    build: ./services/node
    ports:
      - "3000:3000"
    environment:
      - PYTHON_BASE_URL=http://python:8000
    volumes:
      - ./services/node:/app
      - ./shared:/shared
      - node_modules:/app/node_modules
    depends_on:
      - python

  python:
    build: ./services/python
    ports:
      - "8000:8000"
    volumes:
      - ./services/python:/app
      - ./shared:/shared

volumes:
  node_modules:
  web_node_modules: